<!DOCTYPE html>
<html>
  <head>
    <title>React component for d3.js calendar heatmap graph</title>
  </head>
  <body>
    <div id="root"></div>

    <!-- React Dependencies -->
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Moment CDN for dummy data -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.3/moment.min.js"></script>

    <!-- d3 CDN for dummy data -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.4.4/d3.min.js"
      integrity="sha512-hnFpvCiJ8Fr1lYLqcw6wLgFUOEZ89kWCkO+cEekwcWPIPKyknKV1eZmSSG3UxXfsSuf+z/SgmiYB1zFOg3l2UQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <!-- Calendar Heatmap -->
    <script src="./dist/calendar-heatmap.js"></script>

    <!-- Example Component -->
    <script type="text/babel" defer>
      const { CalendarHeatmap: Chart } = CalendarHeatmap;
      class App extends React.Component {
        constructor(props) {
          super(props);

          // Initialize random data for the demo
          let now = moment().endOf('day').toDate();
          let time_ago = moment().startOf('day').subtract(10, 'year').toDate();
          let data = d3
            .timeDays(time_ago, now)
            .map(function (dateElement, index) {
              return {
                date: dateElement,
                details: Array.apply(
                  null,
                  new Array(Math.floor(Math.random() * 15))
                ).map(function (e, i, arr) {
                  return {
                    name: 'Project ' + Math.ceil(Math.random() * 10),
                    date: (function () {
                      let projectDate = new Date(dateElement.getTime());
                      projectDate.setHours(Math.floor(Math.random() * 24));
                      projectDate.setMinutes(Math.floor(Math.random() * 60));
                      return projectDate;
                    })(),
                    value:
                      3600 * ((arr.length - i) / 5) +
                      Math.floor(Math.random() * 3600) *
                        Math.round(Math.random() * (index / 365)),
                  };
                }),
                init: function () {
                  this.total = this.details.reduce(function (prev, e) {
                    return prev + e.value;
                  }, 0);
                  return this;
                },
              }.init();
            });

          this.state = {
            data: data,
            color: '#cd2327',
            overview: 'year',
          };
        }

        print(val) {
          console.log(val);
        }

        render() {
          return (
            <Chart
              data={this.state.data}
              color={this.state.color}
              overview={this.state.overview}
              handler={this.print.bind(this)}
            ></Chart>
          );
        }
      }

      // Render calendar heatmap component
      const container = document.getElementById('root');
      const root = ReactDOM.createRoot(container);
      root.render(<App />);
    </script>
  </body>
</html>
